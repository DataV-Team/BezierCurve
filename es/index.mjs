/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function n(){for(var n=0,r=0,t=arguments.length;t>r;r++)n+=arguments[r].length;var e=Array(n),u=0;for(r=0;t>r;r++)for(var i=arguments[r],o=0,a=i.length;a>o;o++,u++)e[u]=i[o];return e}function r(n,r,t,e){var u=new Map([]);return function(i){if(u.has(i))return u.get(i);var o=1-i,a=Math.pow(o,3),f=Math.pow(o,2),c=Math.pow(i,3),l=Math.pow(i,2),v=[n[0]*a+3*r[0]*i*f+3*t[0]*l*o+e[0]*c,n[1]*a+3*r[1]*i*f+3*t[1]*l*o+e[1]*c];return u.set(i,v),v}}function t(t){var e=function(n){return n.slice(1)}(t),u=function(n){return n[0]}(t);return e.map((function(t,i){return r.apply(void 0,n([0===i?u:e[i-1][2]],t))}))}function e(n,r){return n.map((function(n,t){var e=1/(r[t]-1);return Array(r[t]).fill(0).map((function(r,t){return n(t*e)}))}))}function u(n){return Array(n.length-1).fill(0).map((function(r,t){return i=(e=n[t])[1],o=(u=n[t+1])[1],Math.sqrt(Math.pow(e[0]-u[0],2)+Math.pow(i-o,2));var e,u,i,o}))}function i(n){return n.reduce((function(n,r){return n+r}),0)}function o(n){var r=function(n){return n.map(u)}(n),t=i(r.map((function(n){return n.length}))),e=r.map(i),o=i(e),a=o/t;return{totalLength:o,segmentLength:e,avgDistance:a,deviation:function(n,r){return i(n.map((function(n){return n.map((function(n){return Math.abs(n-r)}))})).map(i))}(r,a)}}function a(r){return r.reduce((function(r,t){return n(r,t)}),[])}function f(n){return a(n).length}function c(n,r,t,i){void 0===i&&(i=0);var l=o(n);return l.deviation>t?(n=function(n,r,t){var e=t.avgDistance,i=1/f(n)/10;return r.forEach((function(r,t){for(var o=n[t].length,a=1/(o-1),f=Array(o).fill(0).map((function(n,r){return r*a})),c=0;10>c;c++)for(var l=u(n[t]).map((function(n){return n-e})),v=0,h=0;o>h;h++){if(0===h)return;f[h]-=i*(v+=l[h-1]),f[h]>1&&(f[h]=1),0>f[h]&&(f[h]=0),n[t][h]=r(f[h])}})),n}(n=function(n,r,t,u){var i=t.avgDistance,o=t.totalLength,a=t.segmentLength,c=f(n);return c=Math.ceil(i/u*c*1.1),e(r,a.map((function(n){return Math.ceil(n/o*c)})))}(n,r,l,t),r,l=o(n)),i++>10?a(n):c(n,r,t,i)):a(n)}function l(n,r){void 0===r&&(r=5);var u=t(n),i=c(function(n){return e(n,Array(n.length).fill(50))}(u),u,r),o=function(n){return n.slice(-1)[2]}(n);return i.push(o),i}function v(n,r){return void 0===r&&(r=5),n&&n instanceof Array&&n.length>1?"number"!=typeof r?null:l(n,r):null}function h(n,r){void 0===r&&(r=5);var t=v(n,r);return t?null:i(u(t))}function p(n,r){var t=r[0],e=r[1];return[t+(t-n[0]),e+(e-n[1])]}function g(r,t,e,u){if(void 0===t&&(t=!1),void 0===e&&(e=.25),void 0===u&&(u=.25),!(r instanceof Array))return null;if(2>=r.length)return null;var i=r[0],o=Array(r.length-1).fill(0).map((function(i,o){return n(function(n,r,t,e,u){void 0===t&&(t=!1),void 0===e&&(e=.25),void 0===u&&(u=.25);var i=n.length;if(3>i||r>=i)return null;var o=r-1;0>o&&(o=t?i+o:0);var a=r+1;i>a||(a=t?a-i:i-1);var f=r+2;i>f||(f=t?f-i:i-1);var c=n[o],l=n[r],v=n[a],h=n[f];return[[l[0]+e*(v[0]-c[0]),l[1]+e*(v[1]-c[1])],[v[0]-u*(h[0]-l[0]),v[1]-u*(h[1]-l[1])]]}(r,o,t,e,u),[r[o+1]])}));return t&&function(n,r){var t=n[0],e=n.slice(-1)[0];n.push([p(e[1],e[2]),p(t[0],r),r])}(o,i),o.unshift(r[0]),o}var m={bezierCurveToPolyline:v,getBezierCurveLength:h,polylineToBezierCurve:g};export default m;export{v as bezierCurveToPolyline,h as getBezierCurveLength,g as polylineToBezierCurve};
