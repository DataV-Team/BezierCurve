!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((r=r||self).BezierCurve={})}(this,(function(r){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function n(){for(var r=0,n=0,e=arguments.length;e>n;n++)r+=arguments[n].length;var t=Array(r),o=0;for(n=0;e>n;n++)for(var i=arguments[n],u=0,a=i.length;a>u;u++,o++)t[o]=i[u];return t}function e(r){return r.reduce((function(r,n){return r+n}),0)}function t(r){return r.reduce((function(r,e){return n(r,e)}),[])}function o(r,n,e,t){var o=new Map([]);return function(i){if(o.has(i))return o.get(i);var u=1-i,a=Math.pow(u,3),f=Math.pow(u,2),l=Math.pow(i,3),c=Math.pow(i,2),v=[r[0]*a+3*n[0]*i*f+3*e[0]*c*u+t[0]*l,r[1]*a+3*n[1]*i*f+3*e[1]*c*u+t[1]*l];return o.set(i,v),v}}function i(r){var e=function(r){return r.slice(1)}(r),t=function(r){return r[0]}(r);return e.map((function(r,i){return o.apply(void 0,n([0===i?t:e[i-1][2]],r))}))}function u(r,n){return r.map((function(r,e){var t=1/(n[e]-1);return Array(n[e]).fill(0).map((function(n,e){return r(e*t)}))}))}function a(r){return Array(r.length-1).fill(0).map((function(n,e){return i=(t=r[e])[1],u=(o=r[e+1])[1],Math.sqrt(Math.pow(t[0]-o[0],2)+Math.pow(i-u,2));var t,o,i,u}))}function f(r){var n=function(r){return r.map(a)}(r),t=e(n.map((function(r){return r.length}))),o=n.map(e),i=e(o),u=i/t;return{totalLength:i,segmentLength:o,avgDistance:u,deviation:function(r,n){return e(r.map((function(r){return r.map((function(r){return Math.abs(r-n)}))})).map(e))}(n,u)}}function l(r){return t(r).length}function c(r,n,e,o){var i=f(r);return i.deviation>e?(r=function(r,n,e,t){var o=e.avgDistance,i=e.totalLength,a=e.segmentLength,f=l(r);return f=Math.ceil(o/t*f*1.1),u(n,a.map((function(r){return Math.ceil(r/i*f)})).map((function(r){return r>1?r:2})))}(r,n,i,e),t(o>0?r=function(r,n,e,t){var o=e.avgDistance,i=1/l(r)/10;return n.forEach((function(n,e){for(var u=r[e].length,f=1/(u-1),l=Array(u).fill(0).map((function(r,n){return n*f})),c=0;t>c;c++)for(var v=a(r[e]).map((function(r){return r-o})),h=0,p=0;u>p;p++)0!==p&&(l[p]-=i*(h+=v[p-1]),l[p]>1&&(l[p]=1),0>l[p]&&(l[p]=0),r[e][p]=n(l[p]))})),r}(r,n,i=f(r),o):r)):t(r)}function v(r,n,e){void 0===n&&(n=5),void 0===e&&(e=0);var t=i(r),o=c(function(r){return u(r,Array(r.length).fill(50))}(t),t,n,e),a=function(r){return r.slice(-1)[0][2]}(r);return o.push(a),o}function h(r,n,e){if(void 0===n&&(n=5),void 0===e&&(e=0),!(r instanceof Array))throw Error("bezierCurveToPolyline: Invalid input of "+r);if(1>=r.length)throw Error("bezierCurveToPolyline: The length of the bezierCurve should be greater than 1");if("number"!=typeof n)throw Error("bezierCurveToPolyline: Type of precision must be number");return v(r,n,e)}function p(r,n,t){return void 0===n&&(n=5),void 0===t&&(t=0),e(a(h(r,n,t)))}function d(r,n){var e=n[0],t=n[1];return[e+(e-r[0]),t+(t-r[1])]}function g(r,e,t,o){if(void 0===e&&(e=!1),void 0===t&&(t=.25),void 0===o&&(o=.25),!(r instanceof Array))throw Error("polylineToBezierCurve: Invalid input of "+r);if(2>=r.length)throw Error("polylineToBezierCurve: The length of the polyline should be greater than 2");var i=r[0],u=Array(r.length-1).fill(0).map((function(i,u){return n(function(r,n,e,t,o){void 0===e&&(e=!1),void 0===t&&(t=.25),void 0===o&&(o=.25);var i=r.length;if(3>i||n>=i)return null;var u=n-1;0>u&&(u=e?i+u:0);var a=n+1;i>a||(a=e?a-i:i-1);var f=n+2;i>f||(f=e?f-i:i-1);var l=r[u],c=r[n],v=r[a],h=r[f];return[[c[0]+t*(v[0]-l[0]),c[1]+t*(v[1]-l[1])],[v[0]-o*(h[0]-c[0]),v[1]-o*(h[1]-c[1])]]}(r,u,e,t,o),[r[u+1]])}));return e&&function(r,n){var e=r[0],t=r.slice(-1)[0];r.push([d(t[1],t[2]),d(e[0],n),n])}(u,i),u.unshift(r[0]),u}var s={bezierCurveToPolyline:h,getBezierCurveLength:p,polylineToBezierCurve:g};r.bezierCurveToPolyline=h,r.default=s,r.getBezierCurveLength=p,r.polylineToBezierCurve=g,Object.defineProperty(r,"__esModule",{value:!0})}));
